const webAppURL = "YOUR_EXEC_URL_HERE"; // replace with your /exec URL

function onScanSuccess(decodedText) {

  document.getElementById("status").innerHTML =
    "Scanned: " + decodedText + "<br>Processing...";

  // ---- Extract TicketID from full URL QR ----
  try {
    const url = new URL(decodedText);
    const ticketIdOnly = url.searchParams.get("id");

    if (!ticketIdOnly) {
      throw new Error("ID not found in scanned data.");
    }

    // Send ONLY the TicketID to Apps Script
    fetch(webAppURL + "?ticket=" + ticketIdOnly)
      .then(res => res.text())
      .then(result => {
        let status = document.getElementById("status");

        if (result === "MARKED") {
          status.innerHTML = "Attendance Marked ✔";
          status.className = "green";
          document.getElementById("beep-success").play();

        } else if (result === "ALREADY_MARKED") {
          status.innerHTML = "Already Marked ❗";
          status.className = "red";
          document.getElementById("beep-error").play();

        } else {
          status.innerHTML = "Ticket Not Found ❌ (" + result + ")";
          status.className = "red";
          document.getElementById("beep-error").play();
        }
      });

  } catch (error) {
    document.getElementById("status").innerHTML =
      "Error: Invalid QR Code Format ❌";
    document.getElementById("status").className = "red";
    document.getElementById("beep-error").play();
  }
}
