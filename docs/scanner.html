<script>
  const webAppURL = "https://script.google.com/macros/s/AKfycbwkkhb8OOU0LVuZvLK9Y5HxqIPHMG3v9B-e_1j_DNzshXRtGBrzQWL-c4lCQ2YW82Jb/exec";

  function onScanSuccess(decodedText) {
    // SHOW WHAT WAS SCANNED
    document.getElementById("status").innerHTML = "Scanned: " + decodedText + "<br>Processing...";

    // SEND TO WEB APP
    fetch(webAppURL + "?ticket=" + decodedText)
      .then(res => res.text())
      .then(result => {
        let status = document.getElementById("status");

        if (result === "MARKED") {
          status.innerHTML = "Scanned: " + decodedText + "<br><span class='green'>Attendance Marked ✔</span>";
          document.getElementById("beep-success").play();

        } else if (result === "ALREADY_MARKED") {
          status.innerHTML = "Scanned: " + decodedText + "<br><span class='red'>Already Marked ❗</span>";
          document.getElementById("beep-error").play();

        } else {
          status.innerHTML = "Scanned: " + decodedText + "<br><span class='red'>Ticket Not Found ❌</span>";
          document.getElementById("beep-error").play();
        }
      });
  }

  new Html5Qrcode("reader").start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    onScanSuccess
  );
</script>
