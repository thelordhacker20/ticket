// ... (rest of the onScanSuccess function) ...

Â  function onScanSuccess(decodedText) {
Â  Â  document.getElementById("status").innerHTML =
Â  Â  Â  "Scanned: " + decodedText + "<br>Processing...";

Â  Â  // ğŸš¨ FIX START: Extract ONLY the 'id' parameter from the scanned full URL
Â  Â  try {
Â  Â  Â  const url = new URL(decodedText);
Â  Â  Â  const ticketIdOnly = url.searchParams.get('id');

Â  Â  Â  if (!ticketIdOnly) {
Â  Â  Â  Â  throw new Error("ID not found in scanned data.");
Â  Â  Â  }

Â  Â  Â  // Send ONLY the extracted ID to the Apps Script Web App
Â  Â  Â  fetch(webAppURL + "?ticket=" + ticketIdOnly) 
Â  Â  Â  Â  .then(res => res.text())
Â  Â  Â  Â  .then(result => {
Â  Â  Â  Â  Â  let status = document.getElementById("status");

Â  Â  Â  Â  Â  // ... (rest of your success/error logic remains the same) ...

Â  Â  Â  Â  Â  if (result === "MARKED") {
Â  Â  Â  Â  Â  Â  status.innerHTML = "Attendance Marked âœ”";
Â  Â  Â  Â  Â  Â  status.className = "green";
Â  Â  Â  Â  Â  Â  document.getElementById("beep-success").play();
Â  Â  Â  Â  Â  } else if (result === "ALREADY_MARKED") {
Â  Â  Â  Â  Â  Â  status.innerHTML = "Already Marked â—";
Â  Â  Â  Â  Â  Â  status.className = "red";
Â  Â  Â  Â  Â  Â  document.getElementById("beep-error").play();
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  status.innerHTML = "Ticket Not Found âŒ (" + result + ")";
Â  Â  Â  Â  Â  Â  status.className = "red";
Â  Â  Â  Â  Â  Â  document.getElementById("beep-error").play();
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  } catch (error) {
Â  Â  Â  document.getElementById("status").innerHTML = "Error: Invalid QR Code Format âŒ";
Â  Â  Â  document.getElementById("status").className = "red";
Â  Â  Â  document.getElementById("beep-error").play();
Â  Â  }
Â  Â  // ğŸš¨ FIX END
Â  }

// ... (rest of the script) ...
