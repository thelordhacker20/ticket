<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Scan Ticket</title>

  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

  <style>
    body {
      font-family: Arial;
      text-align: center;
      padding: 20px;
    }
    .green { color: green; font-size: 20px; }
    .red { color: red; font-size: 20px; }
  </style>
</head>

<body>

<h2>Scan Ticket</h2>

<div id="reader" style="width: 300px; margin:auto;"></div>
<div id="status"></div>

<audio id="beep-success" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="beep-error" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

<script>

  // üî¥ PUT YOUR EXEC URL HERE
  const webAppURL = "https://script.google.com/macros/s/AKfycbwkkhb8OOU0LVuZvLK9Y5HxqIPHMG3v9B-e_1j_DNzshXRtGBrzQWL-c4lCQ2YW82Jb/exec";

  function onScanSuccess(decodedText) {
    document.getElementById("status").innerHTML =
      "Scanned: " + decodedText + "<br>Processing...";

    fetch(webAppURL + "?ticket=" + decodedText)
      .then(res => res.text())
      .then(result => {
        let status = document.getElementById("status");

        if (result === "MARKED") {
          status.innerHTML = "Attendance Marked ‚úî";
          status.className = "green";
          document.getElementById("beep-success").play();

        } else if (result === "ALREADY_MARKED") {
          status.innerHTML = "Already Marked ‚ùó";
          status.className = "red";
          document.getElementById("beep-error").play();

        } else {
          status.innerHTML = "Ticket Not Found ‚ùå";
          status.className = "red";
          document.getElementById("beep-error").play();
        }
      });
  }

  new Html5Qrcode("reader").start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    onScanSuccess
  );

</script>

</body>
</html>
